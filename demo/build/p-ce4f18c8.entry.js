import{r as t,c as a,h as e,F as i,a as o,g as r}from"./p-e5ae1b6e.js";import{C as s}from"./p-694e4e3f.js";import{g as n,h as l,i as d,p as u,w as b}from"./p-87f291fd.js";import{i as h}from"./p-80ab0189.js";var p,c,v=function(t,a,e,i){if("a"===e&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof a?t!==a||!i:!a.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?i:"a"===e?i.call(t):i?i.value:a.get(t)};const g=["dragenter","dragover"],f=["dragleave","drop"],x=["dragenter","dragover","dragleave","drop"],m=()=>b(0),w=class{constructor(e){t(this,e),this.brxChange=a(this,"brxChange",7),p.set(this,new s),this.updateFileListInProgress=!1,c.set(this,void 0),this.multiple=!1,this.disabled=!1,this.value=null,this.handleUploadFiles=m,this.attachmentAssets=[],this.status=void 0,this.label=void 0,this.messages=[],this.hasFocus=!1,this.accept=void 0,this.autofocus=!1,this.name=void 0,this.readonly=!1,this.required=!1,this.spellcheck=!1,this.step=void 0,this.size=void 0,this.hiddenLabel=void 0,this.labelClass=void 0,this.inputId=void 0}set buttonEl(t){const a=this.buttonEl;(function(t,a,e,i,o){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof a?t!==a||!o:!a.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===i?o.call(t,e):o?o.value=e:a.set(t,e)})(this,c,t,"f"),t!==a&&this.setDragAndDropBehavior()}get buttonEl(){var t;return null!==(t=v(this,c,"f"))&&void 0!==t?t:this.el.querySelector(".upload-button button")}get textHelpEl(){return document.querySelector(".text-base")}get inputEl(){return this.el.querySelector("input")}get uploadListEl(){return this.el.querySelector(".upload-list")}async getAttachmentAssets(){return this.attachmentAssets}setAttachmentAssets(t){null===this.value&&(this.attachmentAssets=t),this.brxChange.emit({attachmentAssets:t})}handleValueChange(){const{value:t}=this;null!==t&&(this.attachmentAssets=t)}handleAttachmentAssetsChange(){const{multiple:t,attachmentAssets:a,inputEl:e}=this;t?e.files=this.getFileList():0===a.length&&(e.value=""),this.updateFileList()}clickUpload(){this.inputEl.click()}handleFiles(t){const{multiple:a}=this;this.messages=[];const e=Array.from(0===t.length?this.inputEl.files:t);!a&&e.length>1?this.addFeedback("danger","É permitido o envio de somente 1 arquivo."):!a&&this.attachmentAssets.length>0?(this.changeFiles(e),this.addFeedback("warning","O arquivo enviado anteriormente foi substituído.")):this.addFiles(e)}hightLight(){this.el.classList.add("dragging")}unHightLight(){this.el.classList.remove("dragging")}handleDrop(t){this.unHightLight();const{files:a}=t.dataTransfer;this.handleFiles(a)}async setDragAndDropBehavior(){const{buttonEl:t}=this;if(t){await v(this,p,"f").run();{const a=t=>{u(t)};for(const e of x)t.addEventListener(e,a),v(this,p,"f").add((()=>{t.removeEventListener(e,a)}))}{const a=()=>{this.hightLight()};for(const e of g)t.addEventListener(e,a),v(this,p,"f").add((()=>{t.removeEventListener(e,a)}))}{const a=()=>{this.unHightLight()};for(const e of f)t.addEventListener(e,a),v(this,p,"f").add((()=>{t.removeEventListener(e,a)}))}{const a=t=>{this.handleDrop(t)};t.addEventListener("drop",a),v(this,p,"f").add((()=>{t.removeEventListener("drop",a)}))}}}addMessage(t){this.messages=[...this.messages,t]}addFeedback(t,a){const e={text:a,severity:t,variant:"feedback",id:`${n()}`};this.addMessage(e),this.status=t}changeFiles(t){const a=t.map((t=>t instanceof Blob?{file:t,id:n()}:t));this.setAttachmentAssets(a)}addFiles(t){this.changeFiles([...this.attachmentAssets,...t])}updateAsset(t,a){this.changeFiles(this.attachmentAssets.map((e=>e.id===t?a(e):e)))}updateFileList(){if(!this.updateFileListInProgress){if(this.updateFileListInProgress=!0,this.status=void 0,this.el.nextElementSibling===this.textHelpEl&&(this.textHelpEl.style.display="none"),this.attachmentAssets.length){this.messages=[];for(let t=0;t<this.attachmentAssets.length;t++)"nowait"in this.attachmentAssets[t]?this.attachmentAssets[t].nowait&&this.renderItem(t):this.attachmentAssets[t].requested||this.uploadingFile(t)}else this.messages=[],this.el.nextElementSibling===this.textHelpEl&&(this.textHelpEl.style.display="");this.updateFileListInProgress=!1}}uploadingFile(t){const a=this.getAssetIdByIndex(t),e=this.getAssetById(a);this.handleUploadFiles&&(this.updateAsset(a,(t=>Object.assign(Object.assign({},t),{requested:!0}))),this.handleUploadFiles(e,t).then((()=>{this.updateAsset(a,(t=>Object.assign(Object.assign({},t),{nowait:!0})))})))}renderItem(t){const a=this.getAssetIdByIndex(t);this.updateAsset(a,(t=>Object.assign(Object.assign({},t),{nowait:!0})))}getAssetIdByIndex(t){var a;const e=this.attachmentAssets[t];return null!==(a=null==e?void 0:e.id)&&void 0!==a?a:null}getAssetById(t){return this.attachmentAssets.find((a=>a.id===t))}removeFileByIndex(t){const a=this.getAssetIdByIndex(t);this.removeFileById(a)}removeFileById(t){t&&(this.status=void 0,this.messages=[],this.changeFiles(this.attachmentAssets.filter((a=>a.id!==t))))}handleUploadButtonClick(t){t.target.closest(".upload-button button")&&this.clickUpload()}handleInputChange(t){const a=t.target.closest("input");a&&this.handleFiles(a.files)}getFileList(){return l(this.attachmentAssets.map((t=>t.file)))}componentWillLoad(){this.inputId||(this.inputId=n())}componentShouldUpdate(t,a,e){switch(e){case"buttonEl":return!1;default:return!0}}get inheritedAttributes(){return h(this.el)}render(){const{hiddenLabel:t,labelClass:a,attachmentAssets:r,messages:s,disabled:n,multiple:l,label:b,inputId:h,inheritedAttributes:p}=this,c=`${h}-lbl`;return e(o,null,e("label",{class:`upload-label ${t?"sr-only":""} ${a}`,id:c,htmlFor:h},b),e("input",Object.assign({class:"upload-input",id:h,type:"file",multiple:l,disabled:n,"aria-labelledby":c,accept:this.accept,autoFocus:this.autofocus,name:this.name,readOnly:this.readonly,required:this.required,step:this.step,size:this.size,tabindex:this.tabindex,spellcheck:this.spellcheck?"true":void 0},p)),e("div",{class:"upload-button"},e("button",{type:"button",class:"brx-button-native",ref:t=>{this.buttonEl=t}},e("brx-icon",{name:"fa5/fas/upload"}),e("span",null,l?"Selecione o(s) arquivo(s).":"Selecione o arquivo."))),s.map((t=>e("brx-message",{key:t.id,variant:t.variant,severity:t.severity,class:"mt-1"},t.text))),e("div",{class:"upload-list"},r.map((({id:t,file:a,requested:o,nowait:r})=>{const s=o&&!r;return e("brx-item",{key:t,class:"d-flex"},!s&&e(i,null,e("brx-tooltip",{class:"mr-auto",place:"top",color:"info",text:a.name},e("div",{class:"content text-primary-default "},e("span",null,a.name))),e("div",{class:"name"}),e("div",{class:"support mr-n2"},e("span",{class:"mr-1"},d(a.size)),e("brx-button",{circle:!0,type:"button",onClick:a=>{u(a),this.removeFileById(t)}},e("brx-icon",{name:"fa5/fas/trash"})))),s&&e("brx-loading",{class:"d-flex mt-1",size:"small"}))}))),e("slot",null))}get el(){return r(this)}static get watchers(){return{value:["handleValueChange"],attachmentAssets:["handleAttachmentAssetsChange"]}}};p=new WeakMap,c=new WeakMap,w.style="brx-upload{display:block}brx-upload brx-loading{display:block;width:100%}brx-upload input{display:none}brx-upload .upload-button{--button-radius:100em;--button-xsmall:24px;--button-small:32px;--button-medium:40px;--button-large:48px;--button-size:var(--button-medium)}brx-upload .upload-button .brx-button-native{-ms-flex-align:center;align-items:center;background-color:transparent;border:0;border-radius:var(--button-radius);color:var(--interactive);cursor:pointer;display:-ms-inline-flexbox;display:inline-flex;font-size:var(--font-size-scale-up-01);font-weight:var(--font-weight-semi-bold);height:var(--button-size);-ms-flex-pack:center;justify-content:center;overflow:hidden;padding:0 var(--spacing-scale-3x);position:relative;text-align:center;vertical-align:middle;white-space:nowrap;width:auto}brx-upload .upload-button .brx-button-native{border:var(--surface-width-sm) dashed var(--interactive);border-radius:var(--surface-rounder-sm);display:block;font-size:var(--font-size-scale-base);font-style:italic;font-weight:var(--font-weight-regular);margin-top:var(--spacing-scale-half);max-width:550px;min-height:var(--button-size);padding-left:var(--spacing-scale-2x);padding-right:var(--spacing-scale-2x);text-align:left;width:100%}brx-upload .upload-button .brx-button-native .svg-inline--fa,brx-upload .upload-button .brx-button-native .fa,brx-upload .upload-button .brx-button-native .fab,brx-upload .upload-button .brx-button-native .fad,brx-upload .upload-button .brx-button-native .fal,brx-upload .upload-button .brx-button-native .far,brx-upload .upload-button .brx-button-native .fas{margin-right:var(--spacing-scale-base)}brx-upload .upload-list{max-width:550px;position:relative}brx-upload .upload-list brx-tooltip{overflow:hidden;max-width:100%;display:-ms-flexbox;display:flex;-ms-flex:1 1;flex:1 1;padding-right:1rem}brx-upload .upload-list brx-tooltip .content{max-width:100%;overflow:hidden}brx-upload .upload-list brx-tooltip .content span{display:block;-ms-flex-item-align:center;align-self:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}brx-upload .upload-list .support{-ms-flex:0 1;flex:0 1;-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex;white-space:nowrap}brx-upload brx-tooltip-content{max-width:93%}brx-upload .upload-button:disabled .brx-button-native,brx-upload .upload-button[disabled] .brx-button-native{cursor:not-allowed}brx-upload .upload-button:not(:disabled):not([disabled]) .brx-button-native{--focus-offset:var(--spacing-scale-half)}brx-upload .upload-button:not(:disabled):not([disabled]) .brx-button-native:focus{outline:none}brx-upload .upload-button:not(:disabled):not([disabled]) .brx-button-native.focus-visible,brx-upload .upload-button:not(:disabled):not([disabled]) .brx-button-native:focus-visible{outline-color:var(--focus);outline-offset:var(--focus-offset);outline-style:var(--focus-style);outline-width:var(--focus-width)}brx-upload .upload-button:not(:disabled):not([disabled]) .brx-button-native:not([data-disable-hover-interaction]):not(:disabled):hover{background-image:-webkit-gradient(linear, left top, left bottom, from(rgba(var(--interactive-rgb), var(--hover))), to(rgba(var(--interactive-rgb), var(--hover))));background-image:linear-gradient(rgba(var(--interactive-rgb), var(--hover)), rgba(var(--interactive-rgb), var(--hover)))}brx-upload .upload-button:not(:disabled):not([disabled]) .brx-button-native:not(:disabled):active{background-image:-webkit-gradient(linear, left top, left bottom, from(rgba(var(--interactive-rgb), var(--pressed))), to(rgba(var(--interactive-rgb), var(--pressed))));background-image:linear-gradient(rgba(var(--interactive-rgb), var(--pressed)), rgba(var(--interactive-rgb), var(--pressed)))}brx-upload .upload-button[active] .brx-button-native{--hover:var(--hover-dark);background-color:var(--active);color:var(--color-dark)}brx-upload .upload-button brx-loading{width:auto;height:auto}brx-upload .upload-button brx-loading::after{margin:0;border-color:var(--interactive) var(--interactive) transparent;border-style:solid}brx-upload .upload-button[variant=primary] brx-loading::after,brx-upload .upload-button[color=success] brx-loading::after,brx-upload .upload-button[color=danger] brx-loading::after,brx-upload .upload-button[color=info] brx-loading::after{border-color:var(--background) var(--background) transparent}brx-upload[status=success] .upload-button .brx-button-native{border-color:var(--success)}brx-upload[status=danger] .upload-button .brx-button-native{border-color:var(--danger)}brx-upload[status=warning] .upload-button .brx-button-native{border-color:var(--warning)}brx-upload[status=info] .upload-button .brx-button-native{border-color:var(--info)}brx-upload.dragging .upload-button .brx-button-native{background-image:-webkit-gradient(linear, left top, left bottom, from(rgba(var(--interactive-rgb), var(--hover))), to(rgba(var(--interactive-rgb), var(--hover))));background-image:linear-gradient(rgba(var(--interactive-rgb), var(--hover)), rgba(var(--interactive-rgb), var(--hover)))}";export{w as brx_upload}